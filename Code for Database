# CNA 330 Group Project fuel prices throughout the years. How the pandemic has affected gas prices#
# Collaborated with Eric, Dillion, Igor, Vlado, Mohammad,
# Help from Justin Ellis & Zac Rubin #
# 12/9/2020 #
# This script pulls from the eia website and stores fuel prices into a database. It takes the information and compiles into a xcel sheet.
# CNA 330 Group Project
# https://www.geeksforgeeks.org/how-to-convert-pandas-dataframe-into-sql-in-python/

from sqlalchemy import create_engine
import pandas
import mysql.connector
import socket

socket.getaddrinfo('localhost', 3306)

config = {
  'user': 'root',
  'password': 'root',
  'host': '127.0.0.1',
  'database': 'mysql',
  'raise_on_warnings': True,
}

link = mysql.connector.connect(**config)


tables = pandas.read_excel ('https://www.eia.gov/dnav/pet/xls/PET_PRI_GND_DCUS_NUS_W.xls', sheet_name='Data 1',
                            header = 2, index_col='Date')
tables.rename(columns = {'Weekly West Coast (PADD 5) Except California No 2 Diesel Ultra Low Sulfur (0-15 ppm) Retail Prices  (Dollars per Gallon)'
                         :'Diesel_Price'}, inplace=True)

engine = create_engine("mysql+pymysql://{user}:{pw}@{host}/{db}"
            .format(host="127.0.0.1", db="mysql", user="root", pw="root"))

connection=engine.connect()

tables.to_sql('Fuel', con = engine, if_exists = 'append')

engine.execute('CREATE TABLE Fuel_temp Like Fuel')
engine.execute('INSERT INTO Fuel_temp SELECT DISTINCT (Date), Diesel_Price FROM Fuel ')
engine.execute('DROP TABLE Fuel')
engine.execute('ALTER TABLE Fuel_temp RENAME TO Fuel')

connection.close()
